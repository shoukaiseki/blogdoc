# 全球性亿兆级别数据库架构

比如做一个全球性的应用,比如存放交易记录的模块,数据量达到兆亿级别,那么需要N台服务器去做,建立多个数据库,然后又分N个表

如下图,比如现在数据库服务主机有14台,每台都建立14个数据库或者实例,而每个实例都分成14张表去存放,那么总共有2744张表

这么多张表,查询一个用户的交易记录,如果把数据分散存放,那么交易服务查询起来效率就会很低,效率最高的方式当然是能够定位到这个用户存储的数据在哪个位置,

一次查询出来所有需要数据是最高效的,那么怎么定位这个位置呢?

最高效的方法就是,用户表新建个字段SAVEDIMENSION,比如用户001,这个字段值设置为004-004-004,用户登录时候把这个值回传给客户机,这样不管他连接到哪台交易服务的主机,

就能知道先获得"主机004"的IP和端口,再根据"数据库004"创建连接,对004表进行查询,查询效率完全没有大数据量带来的影响

![image](https://raw.githubusercontent.com/shoukaiseki/blogdoc/master/%E4%BA%92%E8%81%94%E7%BD%91/%E5%85%A8%E7%90%83%E6%80%A7%E4%BA%BF%E5%85%86%E7%BA%A7%E5%88%AB%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9E%B6%E6%9E%84/img/001.png)



### 同一用户数据分散存放缺点
如果你们自己的业务数据量没那么大,只是根据当前用户量过多而去新建库和表去存放新增的数据,然后查询时候都查一遍,

那么一个新用户刚注册的,以前的库里根本没有数据,这样查一遍就浪费了资源,随着业务量的增加,查询资源的浪费也是按几何倍速增加的.



## 时间段区域用户高并发对单一数据库负载增加怎么办?
对于这种情况,这种级别的数据量读写分离是要做的,而我们插入的时候可以进行负载均衡分配,先将记录保存到其它库表中,每个库中都建立一个索引表,存放待转移数据

建立后台定时任务对这些数据进行处理,最后数据库直接进行交互同步 (就像魔兽中圣骑士,法师,战士,猎人,牧师打BOSS爆了一屏幕装备,1分钟要捡完,不然消失了,那么大家肯定是先捡,不管是不是自己用的,空下来后再将其它职业的装备给对应的人,而不是自己一个一个去问有没有我的装备,这样效率低)



## 数据的活跃期
就像我们支付宝交易记录,银行卡交易记录,因为我们活着在用,他就是活跃的,是经常使用的,但是过滤50年之后,死了一批人,那这一批数据很少去查了,那怎么把这些数据删选出来封存呢?

这样结构的数据库设计就能很高效的去处理,


## 先写到这,睡觉了
