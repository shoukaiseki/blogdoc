<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>蒋カイセキ 的博客</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">蒋カイセキ 的博客</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">SyntaxHighlighter 源代码自动转换成Html</h2>
	<h5 id="">2012-02-04 14:08:19&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/shoukaiseki/blog/static/1928561492012142819427/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><h1 style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font-family: Verdana, sans-serif, 宋体; line-height: normal;"  ><span style="background-color: rgb(255, 255, 255);"  ><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 28px; font-family: Helvetica; font-size: small;"  ><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 25px;"  >下载地址</span></span><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 25px;"  ><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 28px; font-family: Helvetica; font-size: small;"  >&nbsp;&nbsp;</span></span><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 25px; font-family: Helvetica; font-size: medium;"  >webhttp.7z&nbsp;</span><a style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; color: rgb(68, 102, 187); outline-width: 0px; outline-style: initial; outline-color: initial; " target="_blank" rel="nofollow" href="http://115.com/file/e7lmpsoy#"  >http://115.com/file/e7lmpsoy#</a></span></h1><div style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font-family: Verdana, sans-serif, 宋体; line-height: normal;"  ><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 28px; font-size: small;"  ><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 25px; background-color: rgb(255, 255, 255);"  >文件读入时的编码设置及自动检测,写入时的编码设置.里面包含我使用的其它Java源码,SQL语句</span></span></div><p style="margin-top: 0px; margin-bottom: 20px; line-height: 20px; font-family: Verdana, sans-serif, 宋体;"  ><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 32px; font-size: medium; background-color: rgb(255, 255, 255);"  ><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font-family: Helvetica;"  >解压至F:\后</span><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 44px; font-family: Helvetica;"  >执行</span><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; color: rgb(255, 102, 0);"  ><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;"  ><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font-family: Helvetica;"  >F:\webhttp\syntaxhighlighter_3.0.83\</span></span><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; font-family: Helvetica;"  >thisjavaw.cmd</span></span><span style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 44px; font-family: Helvetica;"  >运行</span></span></p></div><div><pre class="prettyprint"  ><p>package syntaxhighlighter;<br>/**SyntaxHighlighter为源码高亮插件<br> *本程序通过将读入的源码插入Html代码中<br> *插入方式为将读入的文件依次插入到String syntaxhighlighter的尾部<br> *依次为<br> *./Insert_SyntaxHighlighter/Public_Head.html 公用首部内容<br> *LINE_BREAKS         换行符<br> *./Insert_SyntaxHighlighter/java.html    源码后缀名.html<br> *LINE_BREAKS         换行符<br> *源码内容<br> *LINE_BREAKS         换行符<br> *./Insert_SyntaxHighlighter/Public_Last.html 公用末尾内容<br> *输出为Html格式,输出位置及读入位置配置文件为./Insert_SyntaxHighlighter/AutoSyntaxHighlighter.ora<br> *extension=java,sql,h       此为需要转换为Html的后缀名,用','格开,注意区分大小写<br> *sourceCode=F://webhttp//src      此为需要转换的源码路径,递归查找该目录下的源码文件<br> *htmlCode=F://webhttp//bin      此为源码转换为Html后的输出路径,拥有递归功能<br> */<br>import java.awt.BorderLayout;<br>import java.awt.Container;<br>import java.awt.Cursor;<br>import java.awt.Label;<br>import java.awt.event.WindowAdapter;<br>import java.awt.event.WindowEvent;<br>import java.io.BufferedReader;<br>import java.io.File;<br>import java.io.FileInputStream;<br>import java.io.FileOutputStream;<br>import java.io.FileReader;<br>import java.io.FileWriter;<br>import java.io.IOException;<br>import java.io.OutputStreamWriter;<br>import java.io.UnsupportedEncodingException;<br>import java.text.SimpleDateFormat;<br>import java.util.Calendar;<br>import java.util.Date;<br><br>import javax.swing.JFrame;<br>import javax.swing.JScrollPane;<br>import javax.swing.JTextPane;<br><br>import bennkyou.gui.jtextpane.JTextPaneOperating;<br><br>import shoukaiseki.characterdetector.CharacterEncoding;<br>import shoukaiseki.constantlib.CharacterEncodingName;<br>import shoukaiseki.file.FindFile;<br>import shoukaiseki.math.PrintText;<br>import shoukaiseki.string.ConCatLineBreaks;<br><br><br>public class AutoSyntaxHighlighter {<br> public static final String UTF_8 = "UTF-8";<br> public static final String GBK = "GBK";<br> public static PrintText printText=new PrintText(true);//输出模式为GUI模式<br> public static ConCatLineBreaks content=null;//显示到jtextpane的内容<br> /**<br>  * 换行符,因UTF8与GBK编码换行符不同<br>  */<br> public static final  String LINE_BREAKS="\r\n";<br> /**<br>  * 配置文件目录<br>  */<br> public static final  String EXTENSION_PATH="./Insert_SyntaxHighlighter/";<br> public static int zenkai = 0;// 前回输出的字符数<br> public static SimpleDateFormat bartDateFormat = new SimpleDateFormat("yyyy年MM月dd日 HH:mm:ss ");<br> public static Calendar cal =Calendar.getInstance();<br> public static Date date = new Date();<br> public static Date rundate = new Date();//开始正常运行时间<br> <br> public static String urlstring = "";<br> public static File file = new File("./Insert_SyntaxHighlighter");<br> public static File txtfile = new File("./Insert_SyntaxHighlighter/AutoSyntaxHighlighter.ora");<br><br> public static String publicHead="";//保存Public_Head.html内容<br> public static String publicLast="";//保存Public_Last.html内容<br> public static String extension="";<br> public static String sourceCode="";<br> public static String htmlCode="";<br> public static JFrame frame;<br> public static JTextPaneOperating textPane;<br> public static JTextPane textPane2;//文本框2<br> public AutoSyntaxHighlighter() throws UnsupportedEncodingException {<br>  // 初始化所有模块<br>  frame = new JFrame("Maximo监控程序");<br>  textPane = new JTextPaneOperating();<br>  textPane.setCursor(new Cursor(Cursor.TEXT_CURSOR));<br>  textPane.setText("java版本为:" + System.getProperty("java.version")<br>    + "\n换行");<br>  // 设置主框架的布局<br>  Container c = frame.getContentPane();<br>  // c.setLayout(new BorderLayout())<br><br><br>  JScrollPane jsp = new JScrollPane(textPane);// 新建一个滚动条界面，将文本框传入<br>  c.add(jsp, BorderLayout.CENTER);<br>  <br>  /**<br>   *  文本框二<br>   */<br>  textPane2 = new JTextPane();<br>  textPane2.setCursor(new Cursor(Cursor.TEXT_CURSOR));<br>  JScrollPane jsp2 = new JScrollPane(textPane2);// 新建一个滚动条界面，将文本框传入<br>  c.add(jsp2, BorderLayout.SOUTH);<br><br><br>  /**<br>   * 增加标签<br>   */<br>  Label label = new Label("java Version:" + System.getProperty("java.version"));<br>  c.add(label, BorderLayout.NORTH);<br>  <br>  // 利用无名内隐类，增加窗口事件<br>  frame.addWindowListener(new WindowAdapter() {<br>   public void WindowClosing(WindowEvent e) {<br>    // 释放资源，退出程序<br>    frame.dispose();<br>    System.exit(0);<br>   }<br>  });<br><br>  frame.setSize(700, 500);<br>  // 隐藏frame的标题栏,此功暂时关闭，以方便使用window事件<br>  // setUndecorated(true);<br>  frame.setLocation(200, 150);<br>  frame.show();<br> }<br> public static void main(String ages[]) throws IOException{<br>  new AutoSyntaxHighlighter();<br>  printText.setTextPane(textPane);<br>  readini();  <br>  try {<br>      FindFile star=new FindFile(); <br>   File[] files = star.getFiles("./", "*.java");//查找运行目录下的所有文件<br>         files = star.getFiles(sourceCode, extension);//查找sourceCode目录下的extension后缀名的文件<br>         for(int i=0;i&lt;files.length;i++){   <br>             printText.addLastLine(files[i].getPath());<br>             allToHtml(files[i]);<br>         }<br>  } catch (Exception e) {<br>   // TODO: handle exception<br>   printText.addLastLine("目录下无任何文件或无此目录!");<br>  }<br> }   <br> <br> public static void readini() throws IOException{<br>  mkDir();//新建文件夹<br>  newFile();//无配置文件则自动新建文件<br>  reFile();//读取文件<br>  rePublicFile();//读取公用头文件内容<br>  extensionDecoding();//将extension解码为可以进行查找的通配符格式String<br> }<br> <br> public static File newMkDir(String fileName) {<br>  File htmlFile=new File(fileName);<br>  File folder=new File(htmlFile.getParent());<br>  try {<br>    if(!folder.isDirectory()){<br>     if(!folder.mkdirs()){<br>      printText.addLastLine("####创建目录"+folder+"失败,可能为权限不足!####");<br>     }<br>    }<br>    if(!htmlFile.exists()){<br>     if (!htmlFile.createNewFile()) {<br>      printText.addLastLine("####创建文件"+htmlFile+"失败,可能为权限不足!####");<br>    }<br>    }<br>  } catch (Exception e) {<br>   // TODO: handle exception<br>  }<br>  return htmlFile;<br> }<br> public static void mkDir(){<br>  if (!file.isDirectory()) {<br>   file.mkdir();<br>   printText.addLastLine("成功创建一个文件夹"+file+"！");<br>  }<br> }<br> public static void newFile() throws IOException{<br>  // 新建文件<br>  if (!txtfile.exists()) {<br>   if (txtfile.createNewFile()){<br>    printText.addLastLine("配置文件创建成功!");<br>    wrFile();//写入文件<br>   }else{<br>    printText.addLastLine("创建新文件失败!");<br>   }<br>  } else {<br>   printText.addLastLine("发现配置文件"+txtfile+"!");<br>  }<br> }<br><br> public static void wrFile(){<br>  //写入文件<br>  printText.addLastLine("\n写入文件!");<br>  try {<br>   FileWriter fw = new FileWriter(txtfile);<br>   /**FileWriter(File file)<br>    *写入文件对象(文件号):覆盖原文件<br>    *FileWriter(File file, boolean append)<br>    *写入文件对象(文件号,是否覆盖原文件)<br>    */<br>   <br>   String s=wrString();<br>   printText.addLastLine(s);<br>   fw.write(s); // 再写内容<br>   printText.addLastLine("写入成功");<br>   fw.close();<br>  } catch (IOException e) {<br>   e.printStackTrace();<br>  }<br> }<br> <br><br> private static void reFile() {<br>  //读取文件<br>  printText.addLastLine("\n\n读取文件!");<br>  try {<br>   FileReader fr = new FileReader(txtfile);<br>   BufferedReader br=new BufferedReader(fr);<br>   br.mark((int)txtfile.length()+1);//标记当前位置  <br>   /**mark.(int readAheadLimit)<br>    * 关键是参数readAheadLimit的解释，从字面上看是往前读的限制 ，也就是表示“可以再读多少”。再看详细解释：<br>    * 是指当还保留有此mark时（i.e.mark未变化），可以再读入字符数的限制。当所读字符数达到此限制（即等于该限制）<br>    * 或超过此限制之后尝试重设该流的话(reset the stream)，就会导致失败，比方说上例中的异常（产生的原因就是<br>    * 读入的字符数等于readAheadLimit，都是4）。当限制值大于输入缓存（所谓输入缓存，BufferedReader类<br>    * 有两个构造子，其一就有这个参数，无参版本就以默认值替代，大小是8192）时，就会分配一个大小不小于限制值的新缓存<br>    * （这里说不小于其实就是等于）.因此要小心使用大数值。<br>    */<br>   int i=0;<br>   while(br.read()!=-1){<br>    i++;<br>   }<br><br>   br.reset();//复位到最近的标记位  <br>   String sr=null;<br>   String a=null;<br>   String b=null;<br>   while ((sr=br.readLine()) != null)<br>         {<br>//    sr=new String(sr.getBytes(),"UTF8");<br>    if(sr.isEmpty()){<br>     continue;<br>    }<br>    a=sr.substring(0, 1);<br>    if(a.equals("#")){<br>     continue;<br>    }<br>    //取等号位置<br>    int value = sr.indexOf("=");<br>    a=sr.substring(0, value).trim();//=号前面取首尾空<br>    b=sr.substring(value+1,sr.length()).trim();//=号后面取首尾空<br>    if(a.equals("extension")){<br>     extension=b;<br>     printText.addLastLine("extension="+extension);<br>     continue;<br>    }if(a.equals("sourceCode")){<br>     //将\\替换为/,//也替换为/<br>     sourceCode=b.replace("\\", "/").replace("//", "/");<br>     if (sourceCode.substring(sourceCode.length()-1, sourceCode.length()).equals("/")) {<br>      sourceCode=sourceCode.substring(0,sourceCode.length()-1);<br>     }<br>     printText.addLastLine("sourceCode="+sourceCode);<br>     continue;<br>    }if(a.equals("htmlCode")){<br>     //将\\替换为/,//也替换为/<br>     htmlCode=b.replace("\\", "/").replace("//", "/");<br>     if (htmlCode.substring(htmlCode.length()-1, htmlCode.length()).equals("/")) {<br>      htmlCode=htmlCode.substring(0,htmlCode.length()-1);<br>     }<br>     printText.addLastLine("htmlCode="+htmlCode);<br>     continue;<br>    }<br>         }<br>   br.close();<br>   fr.close();<br>  } catch (IOException e) {<br>   e.printStackTrace();<br>  }<br> }<br> <br> public static String wrString() throws UnsupportedEncodingException{<br>  String s="";<br>  s=s+"#注释符号为#"+LINE_BREAKS;  <br>  s=s+"#此为需要转换为Html的后缀名,用','格开,注意区分大小写"+LINE_BREAKS;<br>  s=s+"extension=java,sql,h,sh"+LINE_BREAKS;<br>  s=s+"#此为需要转换的源码路径,递归查找该目录下的源码文件"+LINE_BREAKS;<br>  s=s+"sourceCode=F:/webhttp/src"+LINE_BREAKS;<br>  s=s+"#此为源码转换为Html后的输出路径,拥有递归功能"+LINE_BREAKS;<br>  s=s+"htmlCode=F:/webhttp/bin"+LINE_BREAKS;<br>  return s; <br> }<br>    /**  <br>     * 将extension解码为可以进行查找的通配符格式String<br>     */   <br> public static void extensionDecoding(){<br>  String[] as=extension.split(",");<br>  extension="";<br>  for (int i = 0; i &lt; as.length; i++) {<br>   extension=extension+"||*."+as[i];<br>  }<br> }<br> /**<br>  * 读入公用文件内容<br>  */<br> private static void rePublicFile() {<br>   publicHead=readFile(EXTENSION_PATH+"Public_Head.html");<br>//   System.out.println(publicHead);<br>   <br>   publicLast=readFile(EXTENSION_PATH+"Public_Last.html");<br>//   System.out.println(publicLast);<br> }<br> public static void allToHtml(File thisfile){<br>  ConCatLineBreaks writeConten=new ConCatLineBreaks();<br>        String fileName=thisfile.getPath();<br>        //将\\替换为/,//也替换为/<br>        fileName=fileName.replace("\\", "/").replace("//", "/");<br>        String htmlFileName=fileName.replace(sourceCode, htmlCode)+".html";<br>        String extensionName=fileName.substring(fileName.lastIndexOf(".")+1,fileName.length());<br>        newMkDir(htmlFileName);<br>//        System.out.println(htmlFileName);<br>        <br><br>  writeConten.addLastLine(publicHead);<br>  writeConten.addLastLineBreaks();<br>  /**<br>   * 读取源码相应配置文件<br>   */<br>  String extensionContent=readFile(EXTENSION_PATH+extensionName+".html");<br>  writeConten.addLastLine(extensionContent);<br>  writeConten.addLastLineBreaks();<br>//  System.out.println(extensionContent);<br>  <br>  /**<br>   * 读取源码内容<br>   */<br>  String s=readFile(fileName);<br>  writeConten.addLastLine(s);<br>  writeConten.addLastLineBreaks();<br><br>  writeConten.addLastLine(publicLast);<br>  writeConten.addLastLineBreaks();<br>  wrFile(new File(htmlFileName), writeConten.getContent());<br> }<br> public static void wrFile(File file,String age0){<br>  printText.addLastLine("正在创建文件"+file.getPath());<br>  try {<br>   //常量类:各编码名称<br>   CharacterEncodingName ce=new CharacterEncodingName();<br>   FileOutputStream o=new FileOutputStream(file);<br>   //采用UTF-8编码格式输出<br>   OutputStreamWriter out =new OutputStreamWriter(o, ce.UTF_8);<br>   out.write(age0);<br>   printText.addLastLine("文件创建写入成功");<br>   out.close();<br>  } catch (Exception e) {<br>   // TODO: handle exception<br>   System.out.println(e);<br>  }<br> }<br> /**<br>  * 读入文件,自动编码转换,返回文件内容<br>  * @param fileName  完整文件名<br>  * @return content  文件内容<br>  */<br> <br> public static String readFile(String fileName){<br>  String content="";<br>  try {<br>   FileInputStream in = new FileInputStream(fileName);<br>   System.out.println("文件字数为="+in.available());<br>   <br>   byte[] bytes = new byte[in.available()];<br>   while((in.read(bytes)) != -1);<br>   String code=CharacterEncoding.getLocalteFileEncode(fileName);<br>   System.out.println("文件编码格式为"+code); <br>   <br>   content= new String(bytes,code);//按照文件编码格式进行转换为系统编码<br>//   System.out.println("文件内容为\n"+content); <br>//   printText.addLastLine(content);<br>   in.close();<br>  } catch (Exception e) {<br>   // TODO: handle exception<br>  }<br>  return content;<br> }<br>}    <br>        </p></pre><br></div></div>
	</div>
</div>
</body>
</html>