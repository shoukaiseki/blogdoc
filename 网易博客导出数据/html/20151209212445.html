<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>蒋カイセキ 的博客</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">蒋カイセキ 的博客</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">tomcat下部署润乾报表</h2>
	<h5 id="">2015-12-09 21:24:45&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/shoukaiseki/blog/static/192856149201511992445610/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><pre class="prettyprint"   ><p><br>---tomcat部署---{{{1<br>数据源测试应用下载(内含下文用到的jar) http://pan.baidu.com/s/1gds2tJd<br>tomcat版本号:Apache Tomcat/7.0.59 <br>java版本号: 1.6.0_24 <br>http://pan.baidu.com/s/1gds2tJd<br>---tomcat 下布置数据源---{{{2<br>以下按照润乾报表应用目录为 rqreport 进行讲解<br>在rqreport下建立一个META-INF/context.xml文件<br>文件内容为<br><br>&lt;?xml version='1.0' encoding='utf-8'?&gt;<br>&lt;Context&gt;<br><br><br>	 &lt;Resource name="reportdb"<br>		 factory="com.alibaba.druid.pool.DruidDataSourceFactory"  <br>		 auth="Container"<br>		 type="javax.sql.DataSource"  <br>		 url="jdbc:oracle:thin:localhost:1521:orcl"<br>		 username="maximo"<br>		 password="maximo"<br>		 initialSize="10"  <br>		 minPoolSize="15"<br>		 maxPoolSize="30"<br>		 maxActive="25"  <br>		 testOnBorrow="false"  <br>		 filters="stat"  <br>		 /&gt;  <br>&lt;/Context&gt;<br><br><br>然后将oracle的驱动包 classes12.jar 复制到 rqreport\WEB-INF\lib下面<br>还需将阿里巴巴的数据源管理包 druid-0.2.9.jar 和 druid-wrapper-0.2.9.jar 也复制到rqreport\WEB-INF\lib下面<br>阿里巴巴的数据源管理包下载地址 http://pan.baidu.com/s/1kTikNrh<br><br>---修改数据源文件---{{{2<br>编辑rqreport\WEB-INF\reportConfig.xml<br>将<br><br>    &lt;config&gt;<br>      &lt;name&gt;dataSource&lt;/name&gt;<br>      &lt;value&gt;reportdb,reportdb,oracle,GBK,0&lt;/value&gt;<br>    &lt;/config&gt;<br><br>更改为<br><br>    &lt;config&gt;<br>      &lt;name&gt;dataSource&lt;/name&gt;<br>	  &lt;!--tomcat下用 java:comp/env/reportdb--&gt;<br>	  &lt;!--weblogic下用 reportdb--&gt;<br>      &lt;value&gt;java:comp/env/reportdb,reportdb,oracle,GBK,0&lt;/value&gt;<br>    &lt;/config&gt;<br><br>到此数据源已经配置完成<br><br>---测试数据源---{{{2<br>在rqreport下面建立一个 test.jsp 文件,内容如下<br><br>&lt;%@ page language="java" import="java.util.*,java.text.*" pageEncoding="UTF-8"%&gt;<br>&lt;%@ page import="javax.naming.*"%&gt;<br>&lt;%@ page import="java.sql.*"%&gt;<br>&lt;%@ page import="javax.sql.*"%&gt;<br>&lt;%<br>	 InitialContext ctx = new InitialContext();<br>	//tomcat下面调用数据源方式<br>	DataSource ds = (DataSource) ctx.lookup("java:comp/env/reportdb");<br><br>	//weblogic下面调用数据源方式<br>	//DataSource ds = (DataSource) ctx.lookup("reportdb");<br>	Connection conn = ds.getConnection();<br>	Statement st = conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,<br>	ResultSet.CONCUR_READ_ONLY);<br>	ResultSet rs = st.executeQuery("select sysdate from dual");<br>	String asus="空";<br>	if(rs.next()){<br>		asus=new SimpleDateFormat ("yyyy年MM月dd日 HH:mm:ss").format(rs.getTimestamp(1));<br>	}<br><br>	conn.close();<br>%&gt;<br>tomcat版本号:&lt;%= application.getServerInfo() %&gt;<br>&lt;br&gt;<br>java版本号:<br>&lt;%=System.getProperty("java.version")%&gt;<br>&lt;br&gt;<br>数据库时间=<br>&lt;%=asus%&gt;<br><br><br>---测试访问---{{{3<br>浏览器输入 http://localhost:8080/rqreport/test.jsp <br>如果无报错,正确显示出时间则证明配置的数据源是可以使用的<br><br><br>---weblogic部署---{{{1<br>weblogic数据源添加方式请搜狗(为什么推荐用搜狗,因为百度已经彻底商业化了,很多答案无法第一时间搜索到了)<br>测试数据源的方式请参考tomcat部署的说明(注意备注)<br>下面简单讲解下<br><br>---编辑rqreport\WEB-INF\reportConfig.xml---{{{2<br>使用<br><br>    &lt;config&gt;<br>      &lt;name&gt;dataSource&lt;/name&gt;<br>      &lt;value&gt;reportdb,reportdb,oracle,GBK,0&lt;/value&gt;<br>    &lt;/config&gt;<br><br><br>---test.jsp---{{{2<br><br>&lt;%@ page language="java" import="java.util.*,java.text.*" pageEncoding="UTF-8"%&gt;<br>&lt;%@ page import="javax.naming.*"%&gt;<br>&lt;%@ page import="java.sql.*"%&gt;<br>&lt;%@ page import="javax.sql.*"%&gt;<br>&lt;%<br>	 InitialContext ctx = new InitialContext();<br>	//tomcat下面调用数据源方式<br>	//DataSource ds = (DataSource) ctx.lookup("java:comp/env/reportdb");<br><br>	//weblogic下面调用数据源方式<br>	DataSource ds = (DataSource) ctx.lookup("reportdb");<br>	Connection conn = ds.getConnection();<br>	Statement st = conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,<br>	ResultSet.CONCUR_READ_ONLY);<br>	ResultSet rs = st.executeQuery("select sysdate from dual");<br>	String asus="空";<br>	if(rs.next()){<br>		asus=new SimpleDateFormat ("yyyy年MM月dd日 HH:mm:ss").format(rs.getTimestamp(1));<br>	}<br><br>	conn.close();<br>%&gt;<br>tomcat版本号:&lt;%= application.getServerInfo() %&gt;<br>&lt;br&gt;<br>java版本号:<br>&lt;%=System.getProperty("java.version")%&gt;<br>&lt;br&gt;<br>数据库时间=<br>&lt;%=asus%&gt;<br><br>---数据源获取方式比较---{{{1<br>从上文可以得知<br>---tomcat的数据源获取比较繁琐---{{{2<br>DataSource ds = (DataSource) ctx.lookup("java:comp/env/reportdb");<br><br>---而weblogic下面调用数据源方式相对简洁---{{{2<br>DataSource ds = (DataSource) ctx.lookup("reportdb");<br><br>因此在润乾报表中获取数据源时就需要做出调整<br>---tomcat---{{{3<br>    &lt;config&gt;<br>      &lt;name&gt;dataSource&lt;/name&gt;<br>      &lt;value&gt;java:comp/env/reportdb,reportdb,oracle,GBK,0&lt;/value&gt;<br>    &lt;/config&gt;<br>---weblogic---{{{3<br>    &lt;config&gt;<br>      &lt;name&gt;dataSource&lt;/name&gt;<br>      &lt;value&gt;reportdb,reportdb,oracle,GBK,0&lt;/value&gt;<br>    &lt;/config&gt;<br>以上说明可以通过创建修改test.jsp测试便可熟知<br><br>---注---{{{1<br>jdk1.7使用将会异常,因为在java的新版本接口有变动,跟classes12.jar老驱动不兼容<br>tomcat8.0不支持jdk1.6版本<br>所以采用了 tomcat7.0和jdk1.6的搭配使用<br><br><br></p></pre><br><wbr></div>
	</div>
</div>
</body>
</html>