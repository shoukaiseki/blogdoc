<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>蒋カイセキ 的博客</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">蒋カイセキ 的博客</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Swing JTable Excel复制粘贴兼容</h2>
	<h5 id="">2012-03-08 18:29:37&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/shoukaiseki/blog/static/19285614920122862937143/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>把swing JTable源码中的 // &nbsp;ExcelAdapter myAd = new ExcelAdapter(table);注释取消即可</div><div><pre class="prettyprint"  ><p>package shoukaiseki.gui.jtable;<br>/**<br> * 经过修改,已完美兼容excel,源程序常用空格,现已修改用\n(下一单元格)\t(右边单元格)<br> * 只对java Swing JTables的表有效<br> * 实现Swing的JTables和Excel间的复制和粘贴功能<br> * 单元格兼容,但是多个单元格不兼容<br> */<br>import java.awt.Toolkit;<br>import java.awt.datatransfer.Clipboard;<br>import java.awt.datatransfer.DataFlavor;<br>import java.awt.datatransfer.StringSelection;<br>import java.awt.event.ActionEvent;<br>import java.awt.event.ActionListener;<br>import java.awt.event.KeyEvent;<br>import java.util.StringTokenizer;<br><br>import javax.swing.JComponent;<br>import javax.swing.JOptionPane;<br>import javax.swing.JTable;<br>import javax.swing.KeyStroke;<br><br>public class ExcelAdapter implements ActionListener {<br> private String rowstring, value;<br> private Clipboard system;<br> private StringSelection stsel;<br> private JTable jTable1;<br><br> /**<br>  * Excel 适配器由 JTable 构成， 它实现了 JTable 上的复制粘贴 功能，并充当剪贴板监听程序。<br>  */<br> public ExcelAdapter(JTable myJTable) {<br>  jTable1 = myJTable;<br>  KeyStroke copy = KeyStroke.getKeyStroke(KeyEvent.VK_C,<br>    ActionEvent.CTRL_MASK, false);<br>  // 确定复制按键用户可以对其进行修改<br>  // 以实现其它按键组合的复制功能。<br>  KeyStroke paste = KeyStroke.getKeyStroke(KeyEvent.VK_V,<br>    ActionEvent.CTRL_MASK, false);<br>  // 确定粘贴按键用户可以对其进行修改<br>  // 以实现其它按键组合的复制功能。<br>  jTable1.registerKeyboardAction(this, "Copy", copy,<br>    JComponent.WHEN_FOCUSED);<br>  jTable1.registerKeyboardAction(this, "Paste", paste,<br>    JComponent.WHEN_FOCUSED);<br>  system = Toolkit.getDefaultToolkit().getSystemClipboard();<br> }<br><br> /**<br>  * 此适配器运行图表的公共读方法。<br>  */<br> public JTable getJTable() {<br>  return jTable1;<br> }<br><br> public void setJTable(JTable jTable1) {<br>  this.jTable1 = jTable1;<br> }<br><br><br> public void actionPerformed(ActionEvent e) {<br>  /**源语句if (e.getActionCommand().compareTo("Copy") == 0) {<br>   * 现取消copy<br>   */<br>  if (e.getActionCommand().compareTo("Copy") == 0) {<br>//   System.out.println("copy");<br>   StringBuffer sbf = new StringBuffer();<br>   // 检查以确保我们仅选择了单元格的<br>   // 相邻块<br>   int numcols = jTable1.getSelectedColumnCount();<br>   int numrows = jTable1.getSelectedRowCount();<br>   int[] rowsselected = jTable1.getSelectedRows();<br>   int[] colsselected = jTable1.getSelectedColumns();<br>   if (!((numrows - 1 == rowsselected[rowsselected.length - 1]<br>     - rowsselected[0] &amp;&amp; numrows == rowsselected.length) &amp;&amp; (numcols - 1 == colsselected[colsselected.length - 1]<br>     - colsselected[0] &amp;&amp; numcols == colsselected.length))) {<br>    JOptionPane.showMessageDialog(null, "Invalid Copy Selection",<br>      "Invalid Copy Selection", JOptionPane.ERROR_MESSAGE);<br>    return;<br>   }<br>   for (int i = 0; i &lt; numrows; i++) {<br>    for (int j = 0; j &lt; numcols; j++) {<br>     sbf.append(jTable1.getValueAt(rowsselected[i],<br>       colsselected[j]));<br>     if (j &lt; numcols - 1)<br>      sbf.append("\t");<br>    }<br>    sbf.append("\n");<br>   }<br>   stsel = new StringSelection(sbf.toString());<br>   system = Toolkit.getDefaultToolkit().getSystemClipboard();<br>   system.setContents(stsel, stsel);<br>  }<br>  if (e.getActionCommand().compareTo("Paste") == 0) {<br>//   System.out.println("Trying to Paste");<br>   int startRow = (jTable1.getSelectedRows())[0];<br>   int startCol = (jTable1.getSelectedColumns())[0];<br>   try {<br>    String trstring = (String) (system.getContents(this)<br>      .getTransferData(DataFlavor.stringFlavor));<br>//       byte[] b=trstring.getBytes();<br>//<br>//    System.out.println("将String型转换为二进制,十六进制");<br>//       for (int i = 0; i &lt; b.length; i++) {<br>//        System.out.print(Integer.parseInt(Integer.toHexString(b[i]&amp;0xff), 16)+"\t");<br>////        System.out.print(Integer.toHexString(b[i]&amp;0xff)+"\t");<br>//           if((i+1)%10==0&amp;&amp;i!=0){<br>//            System.out.println();<br>//           }<br>//       }<br>//          System.out.println();<br>          <br>//    System.out.println("String is:" + trstring);<br>    String[] st1 = trstring.split("\n",-1);//分割符为\n,空字符不丢弃<br>    /**<br>     * t1.length-1为最后一个\n后面不做一个数组处理<br>     */<br>    for (int i = 0; i &lt; st1.length-1; i++) {<br>     rowstring = st1[i];<br>//     rowstring=rowstring.replace("\n", "");//<br>     String[]  st2 = rowstring.split("\t",-1);//分割符为\t<br>     for (int j = 0; j&lt;st2.length; j++) {<br>      value =st2[j];<br>//      value=value.replace("\t", "");//<br>//      System.out.println(value);<br>      if (startRow + i &lt; jTable1.getRowCount()<br>        &amp;&amp; startCol + j &lt; jTable1.getColumnCount())<br>       jTable1.setValueAt(value, startRow + i, startCol<br>         + j);<br>//      System.out.println("Putting " + value + " atrow="<br>//        + startRow + i + " column=" + startCol + j);<br>     }<br>    }<br>   } catch (Exception ex) {<br>    ex.printStackTrace();<br>   }<br>  }<br> }<br>}</p></pre><br></div></div>
	</div>
</div>
</body>
</html>