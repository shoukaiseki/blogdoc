<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>蒋カイセキ 的博客</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">蒋カイセキ 的博客</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">JS代码语法着色.htm</h2>
	<h5 id="">2012-01-04 16:13:29&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/shoukaiseki/blog/static/19285614920120441329760/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</div><div>&lt;html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN"&gt;</div><div>&lt;head&gt;</div><div>&lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;</div><div>&lt;title&gt; lJSParser &nbsp; &nbsp; &nbsp; &nbsp;: Little JavaScript Parser v2.0 &lt;/title&gt;</div><div>&lt;meta name="author" content="CN.LEI" /&gt;</div><div>&lt;meta name="copyright" content="scriptpower@qq.com , http://www.cnlei.com" /&gt;</div><div>&lt;script type="text/javascript"&gt;</div><div>if(typeof(window["lJSF"])=="undefined")window["lJSF"]={</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Version &nbsp; &nbsp; &nbsp; &nbsp;:"2.5.2&lt;std_lv_n_-10&gt;",</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Author &nbsp; &nbsp; &nbsp; &nbsp;:"CN.LEI",</div><div>&nbsp; &nbsp; &nbsp; &nbsp; EMail &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;:"scriptpower@qq.com",</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Website &nbsp; &nbsp; &nbsp; &nbsp;:"http://www.cnlei.com"</div><div>};</div><div>lJSF.obj={};</div><div>lJSF.obj.JSParser={};</div><div>/*</div><div>* lJSParser &nbsp; &nbsp; &nbsp; &nbsp;: Little JavaScript Parser v2.0</div><div>****************************************************</div><div>* Author &nbsp; &nbsp; &nbsp; &nbsp;: CN.LEI</div><div>* Mail &nbsp; &nbsp; &nbsp; &nbsp;: scriptpower@qq.com</div><div>* WebSite &nbsp; &nbsp; &nbsp; &nbsp;: http://www.cnlei.com</div><div>* Created &nbsp; &nbsp; &nbsp; &nbsp;: 2010-01-01</div><div>* Update &nbsp; &nbsp; &nbsp; &nbsp;: 2010-01-23</div><div>****************************************************</div><div>* 1. 解析JavaScript语法</div><div>&nbsp; &nbsp; 分析JS代码中的纯代码、字符串、正则、注释等等对其进行归类，按序存入数组中，并返回该数组以供其它API接口使用。</div><div>* 2. 扩展功能：</div><div>&nbsp; &nbsp; 以此解析器的返回结果为基础，可方进行以下各种功能扩展和实现</div><div>&nbsp; &nbsp; a. JS语法标亮着色、</div><div>&nbsp; &nbsp; b. JS代码压缩合并、</div><div>&nbsp; &nbsp; c. JSON数据安全检测</div><div>&nbsp; &nbsp; d. 等等</div><div>****************************************************</div><div>* lJSF.obj.JSParser.parse(jscode)</div><div>* @param</div><div>&nbsp; jscode &nbsp; &nbsp; &nbsp; &nbsp;: 待解析的JavaScript代码, String类型</div><div>* @return &nbsp; &nbsp; &nbsp; &nbsp;:</div><div>&nbsp; &gt;&gt; 格式:</div><div>&nbsp; [code,flag,value,code,flag,value...,code,flag,value,code,-1,空串]</div><div>&nbsp; 即:</div><div>&nbsp; [js,0,正则值,js,1,单引号字符串值,js,2,双引号字符串值,js,7,单行注释内容,js,8,多行注释内容,s,-1,空串]</div><div>&nbsp; &gt;&gt; flag含义：</div><div>&nbsp; &nbsp; &nbsp; &nbsp; -1 &nbsp; &nbsp; &nbsp; &nbsp;: 空串</div><div>&nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;: 正则</div><div>&nbsp; &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp;: 单引号</div><div>&nbsp; &nbsp; &nbsp; &nbsp; 2 &nbsp; &nbsp; &nbsp; &nbsp;: 双引号</div><div>&nbsp; &nbsp; &nbsp; &nbsp; 7 &nbsp; &nbsp; &nbsp; &nbsp;: 单行注释</div><div>&nbsp; &nbsp; &nbsp; &nbsp; 8 &nbsp; &nbsp; &nbsp; &nbsp;: 多行注释</div><div>*/</div><div>lJSF.obj.JSParser.parse=function(string){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; string=string.replace(/([^\r])\n/g,"$1\r\n");</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var i=0,length=string.length,end,last=0;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var c,cr,ret=[],js,mode,tmp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var regStart=false,regTest=/[\,\=\?\:\&amp;\!\(\[\;\|\+\-\*\%\~\&lt;\&gt;]\s*$/;//正则前缀特征检测</div><div>&nbsp; &nbsp; &nbsp; &nbsp; function endFlag(string,c,i,length){//查找后缀位置</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var n=-1,x;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while(i++&lt;length){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x=string.charAt(i);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(x==c){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n=i;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(x=="\\"){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i++;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return n;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; function endReg(string,i,length){//查找正则结束位置</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var end=endFlag(string,"\/",i,length);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var startZ=endFlag(string,"\[",i,length);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(startZ&lt;0 || startZ&gt;end){//正则中无中括号</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return end;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {//startZ&lt;end : 正则中有中括号</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var endZ=endFlag(string,"\]",startZ,length);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(endZ&lt;0){//正则非法</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return -1;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {//继续往后找</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return endReg(string,endZ,length);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; function isRegPre(A,js){//判断是否为正则前缀</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var b=true,t;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(var i=A.length-3;i&gt;=0;i-=3){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t=A[i+1];</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(t&gt;=7){//多行注释</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!/^\s*$/.test(A[i])){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b=regTest.test(A[i]);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!b)b=/\/\s*$/.test(A[i]);//正则作为除数</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b=!!js &amp;&amp; /\/\s*$/.test(js);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return b;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; for(i=0;i&lt;length;){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c=string.charAt(i);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(c=="\""){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end=endFlag(string,"\"",i,length);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(end&gt;i){//找到字符串</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end++;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret.push(string.substring(last,i),2,string.substring(i,end));</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i=last=end;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {//字符串中断</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(c=="\'"){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end=endFlag(string,"\'",i,length);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(end&gt;i){//找到字符串</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end++;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret.push(string.substring(last,i),1,string.substring(i,end));</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i=last=end;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {//字符串中断</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(c=="\/"){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cr=string.charAt(i+1);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!cr)break;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(cr=="\/"){//单行注释</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end=string.indexOf("\r\n",i+2);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(end&lt;0){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end=length;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end+=2;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret.push(string.substring(last,i),7,string.substring(i,end));</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i=last=end;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(cr=="*"){//多行注释</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end=string.indexOf("*\/",i+2);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(end&gt;i){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end+=2;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret.push(string.substring(last,i),8,string.substring(i,end));</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i=last=end;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {//多行注释中断</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {//正则、除法分析</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; js=string.substring(last,i);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; regStart=false;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(regTest.test(js)){//正则开始</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; regStart=true;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else{ //if(/^\s*$/.test(js))</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(/\/\s*$/.test(js)){//正则作为除数</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var retLen=ret.length;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(retLen&gt;0){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(ret[retLen-2]==8){//向前查找特征符</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; regStart=isRegPre(ret,js);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; regStart=true;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; regStart=true;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(/^\s*$/.test(js)){//向前查找特征符</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; regStart=isRegPre(ret,js);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(regStart){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end=endReg(string,i,length);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(end&gt;i){//找到正则</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mode=string.substring(end,end+4);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mode=mode.match(/^\/[igm]*/);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mode=mode[0];</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret.push(js,0,string.substring(i,end)+mode);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i=last=end+mode.length;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //i=end;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {//正则中断</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {//除法</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i++;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }//正则、除法分析 end</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(c=="\\"){//转义符后的字符直接跳过</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i+=2;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i++;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; ret.push(string.substring(last,length),-1,"");</div><div>&nbsp; &nbsp; &nbsp; &nbsp; return ret;</div><div>};</div><div>/*</div><div>JavaScirpt语法关键词词库,可自行定义、修改</div><div>*/</div><div>lJSF.obj.JSParser.Keys=(function(){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var object=function(arr){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var obj={};</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(var i=0,l=arr.length; i&lt;l;i++) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; obj[arr[i]]=arr[i];</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return obj;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var Keys={};</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Keys.key=object("break|case|catch|class|const|continue|debugger|default|delete|do|else|export|extends|false|finally|for|function|if|import|in|instanceof|new|null|protected|return|super|switch|this|throw|true|try|typeof|var|while|with|abstract|boolean|byte|char|decimal|double|enum|final|float|get|implements|int|interface|internal|long|package|private|protected|public|sbyte|set|short|static|uint|ulong|ushort|void|assert|ensure|goto|invariant|namespace|native|require|synchronized|throws|transient|use|volatile".split("|"));</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Keys.object=object("arguments|screen|window|self|parent|opener|event|document|navigator|Math|Array|String|Function|Object|Number|Date|Boolean|Error|Image|Option|location|history|cookie|DOMParser|ActiveXObject|VBArray|XMLHttpRequest|Enumerator".split("|")),</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Keys.func=object("eval|isFinite|isNaN|parseFloat|parseInt|escape|unescape|encodeURIComponent|decodeURIComponent|decodeURI|encodeURI|alert|confirm|prompt|setTimeout|setInterval|clearTimeout|clearInterval".split("|"));</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Keys.method=object("getElementById|getElementsByTagName|getElementsByName|prototype|concat|join|pop|push|reverse|shift|slice|sort|splice|toLocaleString|unshift|getDate|getDay|getFullYear|getHours|getMilliseconds|getMinutes|getMonth|getSeconds|getTime|getTimezoneOffset|getUTCDate|getUTCDay|getUTCFullYear|getUTCHours|getUTCMilliSeconds|getUTCMinutes|getUTCMonth|getUTCSeconds|getVarDate|getYear|setDate|setFullYear|setHours|setMilliSeconds|setMinutes|setMonth|setSeconds|setTime|setUTCDate|setUTCFullYear|setUTCHours|setUTCMilliseconds|setUTCMinutes|setUTCMonth|setUTCSeconds|setYear|toGMTString|toLocaleString|toUTCString|toString|valueOf|parse|toLocaleString|compile|exec|test|charAt|charCodeAt|concat|fromCharCode|indexOf|lastIndexOf|match|replace|search|slice|split|substr|substring|toLowerCase|toUpperCase|isPrototypeOf|hasOwnProperty|abs|acos|asin|atan|atan2|ceil|cos|exp|floor|log|max|min|pow|random|round|sin|sqrt|tan|apply|call".split("|"));</div><div>&nbsp; &nbsp; &nbsp; &nbsp; return Keys;</div><div>})();</div><div>/*</div><div>* lJSColoration &nbsp; &nbsp; &nbsp; &nbsp;: Little JavaScript Coloration v2.0</div><div>****************************************************</div><div>* Author &nbsp; &nbsp; &nbsp; &nbsp;: CN.LEI</div><div>* Mail &nbsp; &nbsp; &nbsp; &nbsp;: scriptpower@qq.com</div><div>* WebSite &nbsp; &nbsp; &nbsp; &nbsp;: http://www.cnlei.com</div><div>* Created &nbsp; &nbsp; &nbsp; &nbsp;: 2010-01-01</div><div>* Update &nbsp; &nbsp; &nbsp; &nbsp;: 2010-1-23</div><div>****************************************************</div><div>* 以lJSParser为基础，扩展实现JavaScript语法着色</div><div>****************************************************</div><div>* lJSF.obj.JSCode.color(strCode,isEncoded)</div><div>* @param</div><div>&nbsp; strCode &nbsp; &nbsp; &nbsp; &nbsp;: 待着色JavaScript代码, String类型</div><div>&nbsp; isEncoded: 待着色代码是否已进行过htmlEncode处理, Boolean类型</div><div>* @return &nbsp; &nbsp; &nbsp; &nbsp;:</div><div>&nbsp; 返回着色后的HTML代码</div><div>*/</div><div>lJSF.obj.JSParser.color=function(code,encoded){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var parse=lJSF.obj.JSParser.parse;//JavaScirpt语法解析器</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var Keys=lJSF.obj.JSParser.Keys;//JavaScirpt语法词库</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var htmlEncode=function(s){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return s.replace(/&amp;/g,"&amp;").replace(/&gt;/g,"&amp;gt;").replace(/&lt;/g,"&amp;lt;");</div><div>&nbsp; &nbsp; &nbsp; &nbsp; };</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var space=function(s){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s=s.replace(/\s+/g,function(ss){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var aa=[],bb=" \t\r\n",ii;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(var i=0,l=ss.length; i&lt;l;i++) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cc=ss.charAt(i);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ii=bb.indexOf(cc);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(ii){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(ii&gt;1){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; aa.push(cc);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; aa.push(" &nbsp; &nbsp;");</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(ss.charAt(i+1) &amp;&amp; bb.indexOf(ss.charAt(i+1))&gt;-1){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; aa.push(" &nbsp;");</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; aa.push(cc);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return aa.join("");</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return s;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; };</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var loop=function(array,callback,step,start){//正向循环</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; step=typeof(step)=="number"?(step&gt;1?step:1):1;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start=typeof(start)=="number"?(start&gt;0?start:0):0;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var end=array.length;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while(start&lt;end){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callback(array[start],start,array);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start+=step;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; };</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var keys={"toString":"toString","valueOf":"valueOf"},</div><div>&nbsp; &nbsp; &nbsp; &nbsp; suf="&lt;/span&gt;",</div><div>&nbsp; &nbsp; &nbsp; &nbsp; pre='&lt;span class="',</div><div>&nbsp; &nbsp; &nbsp; &nbsp; mid="\"&gt;",</div><div>&nbsp; &nbsp; &nbsp; &nbsp; preK=pre+"key"+mid,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; preO=pre+"object"+mid,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; preF=pre+"function"+mid,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; preM=pre+"method"+mid,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; preR=pre+"regexp"+mid,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; preS=pre+"string"+mid,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; preC=pre+"comment"+mid,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; preN=pre+"number"+mid,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; regVar=/\b[a-zA-Z\_\$]\w*?\b/gm,//关键字匹配</div><div>&nbsp; &nbsp; &nbsp; &nbsp; regNum=/((?:^|[^\$]))\b((?:\d*\.?\d+|0x[\da-fA-F]+))\b/g, &nbsp; &nbsp; &nbsp; &nbsp;//数字匹配</div><div>&nbsp; &nbsp; &nbsp; &nbsp; regBR=/\r?\n/,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; RN="\r\n",</div><div>&nbsp; &nbsp; &nbsp; &nbsp; BR="&lt;br /&gt;";</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var A=parse(encoded?code:htmlEncode(code)),N=[],line=1;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; function html(s,pre,suf){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s=space(s);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s=pre+s.replace(regBR,suf+RN+pre)+suf;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return s;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; //统计keys</div><div>&nbsp; &nbsp; &nbsp; &nbsp; loop(A,function(v,i,a){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v.replace(regVar,function(rr){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keys[rr]=rr;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return rr;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });</div><div>&nbsp; &nbsp; &nbsp; &nbsp; },3);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; //分析关键词</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var AK=Keys.key; &nbsp; &nbsp; &nbsp; &nbsp;//JS保留字</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var AO=Keys.object; &nbsp; &nbsp; &nbsp; &nbsp;//内置对象、常用对象</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var AF=Keys.func; &nbsp; &nbsp; &nbsp; &nbsp;//内置函数</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var AM=Keys.method; &nbsp; &nbsp; &nbsp; &nbsp;//常用对象方法</div><div>&nbsp; &nbsp; &nbsp; &nbsp; for(var x in keys) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(x==AK[x]){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keys[x]=preK+x+suf;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(x==AO[x]){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keys[x]=preO+x+suf;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(x==AF[x]){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keys[x]=preF+x+suf;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(x==AM[x]){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keys[x]=preM+x+suf;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; //解决 toString、valueOf 无法标亮</div><div>&nbsp; &nbsp; &nbsp; &nbsp; keys["toString"]=preM+"toString"+suf;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; keys["valueOf"]=preM+"valueOf"+suf;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; //转换为HTML</div><div>&nbsp; &nbsp; &nbsp; &nbsp; loop(A,function(v,i,a){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var s=v.replace(regVar,function(rr){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return keys[rr];</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }).replace(regNum,function(rr,xx,yy){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return xx+preN+yy+suf;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a[i]=space(s);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var t=a[i+1];</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(t==2||t==1){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a[i+2]=html(a[i+2],preS,suf);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(t==0){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a[i+2]=preR+a[i+2]+suf;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(t==7){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a[i+2]=preC+a[i+2].slice(0,-2)+suf+RN;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(t==8){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a[i+2]=html(a[i+2],preC,suf);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a[i+1]="";</div><div>&nbsp; &nbsp; &nbsp; &nbsp; },3);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; A=A.join("").replace(/\r\n/g,function(r){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; N.push(line++);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return BR;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; });</div><div>&nbsp; &nbsp; &nbsp; &nbsp; N.push(line);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; N="&lt;div&gt;"+N.join(BR)+"&lt;/div&gt;";</div><div>&nbsp; &nbsp; &nbsp; &nbsp; A="&lt;div&gt;"+A+"&lt;/div&gt;";</div><div>&nbsp; &nbsp; &nbsp; &nbsp; A='&lt;table class="jscode" cellspacing="0" cellpadding="0"&gt;&lt;tr&gt;&lt;td class="no"&gt;'+N+'&lt;/td&gt;&lt;td class="js"&gt;'+A+'&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;';</div><div>&nbsp; &nbsp; &nbsp; &nbsp; return A;</div><div>};</div><div>&lt;/script&gt;</div><div>&lt;style type="text/css"&gt;</div><div>/*JS语法标亮样式，可自行修改*/</div><div>.jscode {border:2px solid #ccffcc;color:#333;}</div><div>.jscode td {vertical-align:top;padding:10px;line-height:175%;font-family:Geneva,Arial,sans-serif;font-size:14px;}</div><div>.jscode .no {background:#ccffcc;text-align:right;color:#0099cc;}</div><div>.jscode .key {color:#00f;}</div><div>.jscode .object &nbsp; &nbsp; &nbsp; &nbsp;{color:#f00;}</div><div>.jscode .regexp {background:#9900ff;color:#fff;padding:0 3px;}</div><div>/*.jscode .division {color:#ff8080;}*/</div><div>.jscode .string &nbsp; &nbsp; &nbsp; &nbsp;{color:#ff33cc;}</div><div>.jscode .function {color:#0099cc;}</div><div>.jscode .method {color:#ff9900;}</div><div>.jscode .comment {color:#090;}</div><div>.jscode .number {color:#ff0000;font-weight:bold;}</div><div>&lt;/style&gt;</div><div>&lt;/head&gt;</div><div>&lt;body&gt;</div><div>&lt;h1&gt;lJSColoration &nbsp;: Little JavaScript Coloration v2.0&lt;/h1&gt;</div><div>&lt;p&gt;&lt;input type="button" value="源码-完整注释版" onclick="JSColor(document.getElementsByTagName('script')[0].text);" /&gt;</div><div>&lt;input type="button" value="JS语法案例测试" onclick="JSColor(document.getElementById('Case').value);" /&gt;</div><div>&lt;/p&gt;</div><div>&lt;p&gt;请输入JS代码：&lt;br /&gt;&lt;textarea id="JS" rows="15" cols="100"&gt;&lt;/textarea&gt;&lt;/p&gt;</div><div>&lt;p style="display:none;"&gt;&lt;textarea id="Case" rows="15" cols="100"&gt;</div><div>var num=a / /**除法中的释注1**//reg// /**除法中的释注2**/2;</div><div>var str="引号"//紧跟在引号后的注释</div><div>/**释注**///紧跟在多行注释后的单行释注</div><div>var num=/reg//2/*注释夹杂在除法当中*//2/3/5/6/*注释夹杂在除法当中*//7/8/9;</div><div>var reg=/reg///我是紧跟在正则后的注释</div><div>var num=/**释注**//reg// /**除号的行注释**/2;</div><div>var num=/reg/ / /reg/; &nbsp; &nbsp; &nbsp; &nbsp;//正则除以正则</div><div>/*******************************************/</div><div>var num=/reg//2/*注释夹杂在除法当中*//2/3/5/6/*注释夹杂在除法当中*//7/8/9;</div><div>var reg=/reg///我是紧跟在正则后的注释</div><div>var str="绰号"//紧跟在引号后的注释</div><div>/**释注**///释注</div><div>var xxx=/**释注**//reg// /**除号的行注释**/2;</div><div>var num=/reg/ / /reg/ / 2;</div><div>//单行注释</div><div>/* 多行注释 */</div><div>&nbsp; var toString = Object.prototype.toString ;</div><div>&nbsp; var valueOf = Object.prototype.valueOf ;</div><div>&nbsp; var xxx=null;</div><div>var s="";</div><div>var reg=/\//g;</div><div>var reg=/\///2/*注释*//3/4/5;</div><div>/******************* 字符串 *******************/</div><div>var a='单引号';</div><div>var b='xxx\'xxx\'xxx"xxx"xxxx';</div><div>var d="双引号";</div><div>var c='+"+"+'+'+\'+\'+'+'+';</div><div>var sss="xxx\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; xxx\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; xxx\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; xxx";</div><div>var yyy=ss+'xxx\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; xxx\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; xxx\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; xxx';</div><div>/******************* 字符串 end *******************/</div><div>/******************* 正则 *******************/</div><div>var a=100/50+/regx/igm;</div><div>var m = 1 - /2,n=2/ -3; &nbsp; &nbsp; &nbsp; &nbsp;//正则夹杂在减法当中</div><div>alert(typeof(/reg/igm));</div><div>alert([/reg/igm]);</div><div>var a={reg:/reg/igm,method:function(){}};</div><div>var b={reg:/reg/igm,_method:function(){}};</div><div>var c={reg:/reg/igm,$method:function(){}};</div><div>var reg=/reg///我是紧跟在正则后的注释</div><div>var reg=/[//]///我仍然是紧跟在正则后的注释</div><div>alert(typeof(reg));</div><div>var n=1/</div><div>/reg/; &nbsp; &nbsp; &nbsp; &nbsp;//正则用作除数</div><div>alert(n);</div><div>var reg = /[/][+]([\S\s]*?)(?:[+][/]|$)|[/][/](.*)|"((?:\\"|[^"])*)"|'((?:\\'|[^'])*)'/g;</div><div>var num=/reg/ / /reg/; &nbsp; &nbsp; &nbsp; &nbsp;//正则除以正则</div><div>/******************* 除法 *******************/</div><div>var num=/reg//2/*注释夹杂在除法当中*//2/3/5/6/*注释夹杂在除法当中*//7/8/9;</div><div>alert(typeof(num)+":"+num);</div><div>a = 1</div><div>b = 2</div><div>g = {test:function(){return 1}}</div><div>c = a//注释夹杂在除法当中</div><div>/*</div><div>注释夹杂在除法当中</div><div>*/</div><div>/b/g.test(); &nbsp; &nbsp; &nbsp; &nbsp; //此行的 /b/g 为连除</div><div>alert(c);</div><div>/******************* 测试1 *******************/</div><div>var point = function(){</div><div>&nbsp; &nbsp; this.x = 1;</div><div>&nbsp; &nbsp; this.y = 2;</div><div>&nbsp; &nbsp; this.valueOf = function(){return 'Point:('+x+','+y+')'};</div><div>}</div><div>if(c&amp;lt;2)f();</div><div>var m = 1/2;n=2/3 //我是除法</div><div>var long_divide = long/1/2/3/4/5/6/7/8/'a'/'b'/ &nbsp;//我是吓人的长除法~~~</div><div>&nbsp; line2</div><div>var P = new point();</div><div>alert(P.valueOf());</div><div>var rex_factory = function(){return {x:/re/g,y:/rere/g,z:[/re/,/rere/,/rerere/]}};</div><div>/******************* 测试2 *******************/</div><div>function f(test) {</div><div>&nbsp; &nbsp; return (test/*</div><div>&nbsp; &nbsp; /* //</div><div>&nbsp; &nbsp; ' "</div><div>&nbsp; &nbsp; { ;</div><div>&nbsp; &nbsp; \*/ &amp;&amp; // /* // " ' { ; \</div><div>&nbsp; &nbsp; test &amp;&amp;</div><div>&nbsp; &nbsp; " /* //\" \</div><div>&nbsp; &nbsp; \" ' \</div><div>&nbsp; &nbsp; { ;" &amp;&amp;</div><div>&nbsp; &nbsp; ' /* // \</div><div>&nbsp; &nbsp; " \' \</div><div>&nbsp; &nbsp; { ;' &amp;&amp;</div><div>&nbsp; &nbsp; test);</div><div>}</div><div>/******************* 测试3 *******************/</div><div>// test 1</div><div>function myfun(id) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; /* this is mutilcomments "string" keyword: function */</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var str = "this is a string, /*fasasdf*/ //fdsasdf /^reg/";</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var reg = /^fdadfasdf$/ig;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; return "myvalue"; // hahah</div><div>}</div><div>//test 2</div><div>if(str.match(/(?:(?:[!=(,:]|&lt;\/var&gt;|\[|\n)[ \t]*\/$)|^\n?[\t ]*\/$/)){}</div><div>//test 3</div><div>a = 1</div><div>b = 2</div><div>g = {test:function(){return 1}}</div><div>c = a//</div><div>/*</div><div>*/</div><div>/b/g.test();</div><div>alert(c);</div><div>// test 4</div><div>function t4(test) {</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp; return (test/*</div><div>&nbsp; &nbsp; &nbsp; &nbsp; /* //</div><div>&nbsp; &nbsp; &nbsp; &nbsp; ' "</div><div>&nbsp; &nbsp; &nbsp; &nbsp; { ;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; \*/ &amp;&amp; // /* // " ' { ; \</div><div>&nbsp; &nbsp; &nbsp; &nbsp; test &amp;&amp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; " /* // \</div><div>&nbsp; &nbsp; &nbsp; &nbsp; \" ' \</div><div>&nbsp; &nbsp; &nbsp; &nbsp; { ;" &amp;&amp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; ' /* // \</div><div>&nbsp; &nbsp; &nbsp; &nbsp; " \' \</div><div>&nbsp; &nbsp; &nbsp; &nbsp; { ;' &amp;&amp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; test);</div><div><br></div><div>}</div><div>// test 5</div><div>var rexT5 = /[/][+]([\S\s]*?)(?:[+][/]|$)|[/][/](.*)|"((?:\\"|[^"])*)"|'((?:\\'|[^'])*)'/g;</div><div>/******************* 测试4 *******************/</div><div>var chunker = /((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ &gt;+~,(\[\\]+)+|[&gt;+~])(\s*,\s*)?/g,</div><div>&nbsp; done = 0,</div><div>&nbsp; toString = Object.prototype.toString;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; for ( var i = 0, l = Expr.order.length; i &lt; l; i++ ) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var type = Expr.order[i], match;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( (match = Expr.match[ type ].exec( expr )) ) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var left = RegExp.leftContext;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( left.substr( left.length - 1 ) !== "\\" ) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; match[1] = (match[1] || "").replace(/\\/g, "");</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set = Expr.find[ type ]( match, context, isXML );</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( set != null ) {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; expr = expr.replace( Expr.match[ type ], "" );</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; }&lt;/textarea&gt;</div><div>&lt;/p&gt;</div><div>&lt;p&gt;&lt;input type="button" value="开始着色" onclick="JSColor(document.getElementById('JS').value);" /&gt; &lt;input type="button" value="清空代码" onclick="document.getElementById('JS').value='';" /&gt; 本次着色用时&lt;strong id="TIME"&gt;0&lt;/strong&gt;毫秒&lt;/p&gt;</div><div>&lt;div id="JS2"&gt;&lt;/div&gt;</div><div>&lt;script type="text/javascript"&gt;</div><div>var JSColor=function(code){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById("JS").value=code;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; if(code.indexOf("\r\n")&lt;0)code=code.replace(/\n/g,"\r\n"); &nbsp; &nbsp; &nbsp; &nbsp;//非IE下，不含有\r\n</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var color=lJSF.obj.JSParser.color,d;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; d=(new Date()).getTime();</div><div>&nbsp; &nbsp; &nbsp; &nbsp; code=color(code,false);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; d=(new Date()).getTime()-d;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById("JS2").innerHTML=code;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById("TIME").innerHTML=d;</div><div>};</div><div>var code=document.getElementsByTagName("script")[0].text;</div><div>JSColor(code);</div><div>&lt;/script&gt;</div><div>&lt;/body&gt;</div><div>&lt;/html&gt;</div><div><br></div><wbr></div>
	</div>
</div>
</body>
</html>