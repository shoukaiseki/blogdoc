<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>蒋カイセキ 的博客</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">蒋カイセキ 的博客</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">java调用C编写的dll C调用dll 函数指针参数赋值</h2>
	<h5 id="">2013-03-28 20:19:47&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/shoukaiseki/blog/static/19285614920132288611823/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><br><br><br>用C-Free新建一个动态链接库的项目,项目名称为testdll<br>Source Files:testdll.c<br><pre class="prettyprint"   ><p>#include &lt;windows.h&gt;<br>#define _EXPORTDLL<br>#include "testdll.h"<br><br>BOOL APIENTRY DllMain (HINSTANCE hInst     /* Library instance handle. */ ,<br>                       DWORD reason        /* Reason this function is being called. */ ,<br>                       LPVOID reserved     /* Not used. */ )<br>{<br>	switch (reason)<br>	{<br>		case DLL_PROCESS_ATTACH:<br>		break;<br><br>		case DLL_PROCESS_DETACH:<br>		break;<br><br>		case DLL_THREAD_ATTACH:<br>		break;<br><br>		case DLL_THREAD_DETACH:<br>		break;<br>	}<br><br>	/* Returns TRUE on success, FALSE on failure */<br>	return TRUE;<br>}<br><br>void getTest(char* str,char* szValue)<br>{<br>	strcpy(szValue,"213.213"); <br>	_gcvt(213.2134,10,szValue);<br>	printf("getTest.str=%s\n", str);<br>}<br></p></pre>Header Files:testdll.h<br><pre class="prettyprint"   ><p>#ifndef _DLLMAIN_H<br>#define _DLLMAIN_H<br><br>#ifdef	_EXPORTDLL<br>#define _LIBAPI __declspec(dllexport)<br>#else<br>#define _LIBAPI __declspec(dllimport)<br>#endif<br><br>/* Export following functions */<br>_LIBAPI void getTest(char* str,char* szValue);<br><br>#endif<br></p></pre>构建(B)-构建 生成dll文件<br><br>用C-Free新建一个控制台的项目,项目名称为testDllExe<br>Source Files:main.c<br><pre class="prettyprint"   ><p>#include &lt;stdio.h&gt;<br>#include "testdll.h"<br>#pragma comment(lib,"testdll.lib")<br>void Hello(char* szValue);<br>int main(int argc, char *argv[])<br>{<br>	int i;<br>	char ch[5] = {'a','b','c','d','\0'};//方式1<br>	char ch2[]="hello";//方式2<br>	char *ch3 = "world";//方式3<br>	char *ch4[3] = {"welcome", "," ,"doudou745"};//字符指针数组<br>	char asus[32]="FYSIS.U1DCSAI.D1144";//方式2<br>	char szPoint[32] = "FYSIS.U1DCSAI.D1144";<br>	char pdValue[32] = "12323232";<br>	getTest(szPoint, pdValue);<br>	printf("%s\n",asus);<br>	printf("value=%s\n",pdValue);<br>	Hello(pdValue);<br>	printf("value=%s\n",pdValue);<br>	printf("pdValue.double=%f\n", pdValue);<br>	printf("%s\n", ch);<br>	printf("%s\n", ch2);<br>	printf("%s\n", ch3);<br>	printf("double=%f\n", 213.2134);<br>	for (i = 0; i &lt; 3; i++)<br>	{<br>		printf("ch4[%d] = %s\n", i+1, ch4[i]);<br>	}<br>	return 0;<br>}<br><br>void Hello(char *szValue)<br>{<br>	/**方法1-start**/ <br>//	char *pdValue = szValue;<br>//	strcpy(pdValue,"123.23"); <br>	/**方法1-end**/<br>	/**方法2-start**/ <br>	strcpy(szValue,"123.23"); <br>	/**方法2-end**/ <br>}<br><br><br></p></pre>再点击该项目的Source Files选择"添加文件到文件夹",选择testdll项目的testdll.c<br>之后构建(B)-构建,构建(B)-编译,构建(B)-运行<br><br><br><font size="4"   ><b>java调用dll</b></font><br>将testdll.dll复制到项目根目录<br><pre class="prettyprint"   ><p>import java.text.ParseException;<br>import java.text.SimpleDateFormat;<br>import java.util.Date;<br><br>import org.xvolks.jnative.JNative;<br>import org.xvolks.jnative.exceptions.NativeException;<br>import org.xvolks.jnative.pointers.Pointer;<br>import org.xvolks.jnative.pointers.memory.MemoryBlockFactory;<br><br><br>public class testDll {<br><br>	public static void main(String[] args) throws NativeException, IllegalAccessException, ParseException {<br>	    JNative n = new JNative("testdll.dll", "getTest");<br>	    Pointer value = new Pointer(MemoryBlockFactory.createMemoryBlock(64));<br>	    n.setParameter(0, "asus");<br>	    n.setParameter(1, value);<br>	    n.invoke();<br>	    System.out.println("value="+value.getAsDouble(0));<br>	    System.out.println("value="+value.getAsString());<br>	    <br>		<br>	}<br>}<br><br></p></pre></div>
	</div>
</div>
</body>
</html>