<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>蒋カイセキ 的博客</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">蒋カイセキ 的博客</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">swing JTable</h2>
	<h5 id="">2012-03-08 18:25:28&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/shoukaiseki/blog/static/19285614920122862528681/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><p>之前碰到添加列,添加行Exception in thread "AWT-EventQueue-0" java.lang.NullPointerException报错问题,现在终于解决了</p><pre class="prettyprint"  ><p>package shoukaiseki.gui.jtable;<br><br>import java.awt.BorderLayout;<br>import java.awt.Color;<br>import java.awt.Component;<br>import java.awt.Container;<br>import java.awt.Dimension;<br>import java.awt.event.ActionEvent;<br>import java.awt.event.ActionListener;<br>import java.awt.event.MouseAdapter;<br>import java.awt.event.MouseEvent;<br>import java.sql.Connection;<br>import java.sql.DriverManager;<br>import java.sql.ResultSet;<br>import java.sql.Statement;<br>import java.util.Calendar;<br>import java.util.Timer;<br>import java.util.TimerTask;<br>import java.util.Vector;<br><br>import javax.swing.BorderFactory;<br>import javax.swing.Box;<br>import javax.swing.DefaultCellEditor;<br>import javax.swing.JButton;<br>import javax.swing.JFrame;<br>import javax.swing.JLabel;<br>import javax.swing.JPanel;<br>import javax.swing.JScrollPane;<br>import javax.swing.JTable;<br>import javax.swing.JTextField;<br>import javax.swing.ListSelectionModel;<br>import javax.swing.SwingUtilities;<br>import javax.swing.table.AbstractTableModel;<br>import javax.swing.table.DefaultTableModel;<br>import javax.swing.table.JTableHeader;<br>import javax.swing.table.TableModel;<br><br>public class JTableOperating extends JTable {<br> /**<br>  * 表格模型对象<br>  */<br> private DefaultTableModel tableModel;<br> /**<br>  * 表格列名<br>  */<br> private Object[] columns = {};<br> /**<br>  * 表格内容<br>  */<br> private Object[][] rows = {};<br> private Object[] addRowData = {};<br> // 为true说明有线程使用;<br> private boolean status = false;<br> private boolean bFull = false;<br> /**<br>  * 线程的操作类型,为removeRowsALl,addRow<br>  */<br> // Thread thread;<br> private Runnable runnable;<br> private String type = "";<br> private int waittime = 10;<br> private int columnCount = 0;<br><br> public JTableOperating(int arg0, int arg1) {<br>  super(arg0, arg1);<br>  initDefuoruto();<br>  columnCount = this.getColumnCount();<br> }<br><br> public JTableOperating(TableModel dm) {<br><br>  super(dm);<br>  tableModel = (DefaultTableModel) dm;<br>  initDefuoruto();<br>  columnCount = tableModel.getColumnCount();<br> }<br><br> /**<br>  * 默认初始化时开启功能<br>  */<br> public void initDefuoruto() {<br>  /**<br>   * 双击单元格时单元格内容全选<br>   */<br>  this.setDefaultEditor(Object.class, new DefaultCellEditor(<br>    new JTextField()) {<br><br>   @Override<br>   public Component getTableCellEditorComponent(JTable table,<br>     Object value, boolean isSelected, int row, int column) {<br>    final Component textField = super.getTableCellEditorComponent(<br>      table, value, isSelected, row, column);<br><br>    if (textField instanceof JTextField) {<br>     SwingUtilities.invokeLater(new Runnable() {<br><br>      public void run() {<br>       ((JTextField) textField).selectAll();<br>      }<br>     });<br>    }<br>    return textField;<br>   }<br>  });<br><br>  // thread = new Thread() {<br>  // public void run() {<br>  // while (1 == 1) {<br>  // if (status) {<br>  // for (int i = tableModel.getColumnCount(); i &lt; addRowData.length; i++)<br>  // {<br>  // int column = i + 65;<br>  // tableModel.addColumn((char) column);<br>  // removeEditor();<br>  // clearSelection();<br>  // tableModel.fireTableDataChanged();<br>  // // try {<br>  // // sleep(1000);<br>  // // } catch (InterruptedException e) {<br>  // // // TODO Auto-generated catch block<br>  // // e.printStackTrace();<br>  // // }<br>  // }<br>  // // try {<br>  // // sleep(waittime);<br>  // // } catch (InterruptedException e) {<br>  // // // TODO Auto-generated catch block<br>  // // e.printStackTrace();<br>  // // }<br>  // removeEditor();<br>  // clearSelection();<br>  // tableModel.addRow(addRowData);<br>  // tableModel.fireTableDataChanged();<br>  // status = false;<br>  // }<br>  // try {<br>  // sleep(waittime);<br>  // } catch (InterruptedException e) {<br>  // // TODO Auto-generated catch block<br>  // e.printStackTrace();<br>  // }<br>  // }<br>  // }<br>  // };<br>  //<br>  // thread.start();<br> }<br><br> public void init() {<br><br>  // this.setPreferredScrollableViewportSize(new Dimension(600, 100));//<br>  // 设置表格的大小<br>  // this.setRowHeight(30);// 设置每行的高度为20<br>  // this.setRowHeight(0, 20);// 设置第1行的高度为15<br>  // this.setRowMargin(5);// 设置相邻两行单元格的距离<br>  // this.setRowSelectionAllowed(true);// 设置可否被选择.默认为false<br>  // this.setSelectionBackground(Color.white);// 设置所选择行的背景色<br>  this.setSelectionForeground(Color.red);// 设置所选择行的前景色<br>  // this.setGridColor(Color.black);// 设置网格线的颜色<br>  // this.setRowSelectionInterval(0, 2);// 设置初始的选择行,这里是1到3行都处于选择状态<br>  // this.clearSelection();// 取消选择<br>  // this.setDragEnabled(false);// 不懂这个<br>  // this.setShowGrid(false);// 是否显示网格线<br>  // this.setShowHorizontalLines(true);// 是否显示水平的网格线<br>  // this.setShowVerticalLines(true);// 是否显示垂直的网格线<br>  // this.setValueAt("tt", 0, 0);// 设置某个单元格的值,这个值是一个对象<br>  // this.doLayout();<br>  // this.setBackground(Color.lightGray);//背景色<br>  // this.selectAll();// 选择所有行<br><br>  /**<br>   * 是否只选择单个(否则选中的为正行),开启此项之后才使用下面三种模式<br>   */<br>  // "单一选择"<br>  // table.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);<br>  // "连续区间选择"<br>  // table.setSelectionMode(ListSelectionModel.SINGLE_INTERVAL_SELECTION);<br>  // "多重选择"<br>  // table.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);<br><br>  this.setCellSelectionEnabled(true);<br>  this.setColumnSelectionAllowed(true);<br>  <br>  runnable = new Runnable() {<br>   public void run() {<br>//    System.out.println("Runnable--bFull-&gt;" + bFull + "---" + type);<br><br>    if (type.equals("addRow")) {<br>     threadAddRow();<br>    } else if (type.equals("removeRowsAll")) {<br>//     System.out.println("tableModel.setRowCount(0)-&gt;" + "start");<br>     tableModel.setRowCount(0);<br>//     System.out.println("tableModel.setRowCount(0)-&gt;" + "end");<br><br>     while (tableModel.getColumnCount() == 0) {<br>//      System.out.println(tableModel.getColumnCount());<br>      try {<br>       Thread.sleep(10);<br>      } catch (InterruptedException e) {<br>       // TODO Auto-generated catch block<br>       e.printStackTrace();<br>      }<br>     }<br>//     System.out.println("tableModel.setRowCount(0)-&gt;" + bFull+ "---" + type);<br>    }<br>//    tableModel.fireTableDataChanged();<br>//    tableModel.fireTableStructureChanged();<br><br>    bFull = false;<br>//    System.out.println("Runnable--bFull-&gt;" + bFull);<br>   }<br>  };<br> }<br><br> /**<br>  * 清空表格<br>  */<br> public void clearRowsAll() {<br>  // TODO Auto-generated method stub<br>  int hight = this.getRowCount();<br>  removeRowsAll();<br>  tableModel.setRowCount(hight);<br><br> }<br><br> /**<br>  * 删除表格<br>  */<br> public void removeRowsAll() {<br>//  System.out.println("removeRowsAll---&gt;" + status);<br>  operatingTabelThread("removeRowsAll");<br>//  System.out.println("removeRowsAll---&gt;" + status);<br><br> }<br><br> /**<br>  * 如果列不够则自动增加,已ABCDE按照在第几列命名 添加一行到模型的结尾。如果未指定 rowData，则新行将包含 null<br>  * 值。生成添加行的通知。 synchronized<br>  * <br>  * @param rowData<br>  */<br> public synchronized void addRow(Object[] rowData)<br>   throws ArrayIndexOutOfBoundsException {<br>//  System.out.println("addRow---&gt;" + status);<br><br>  if (status) {<br>   try {<br>    wait();<br>   } catch (InterruptedException e) {<br>    // TODO Auto-generated catch block<br>    e.printStackTrace();<br>   } // 后来的线程要等待<br>  }<br>  status = true;<br>  addRowData = rowData;<br>  operatingTabelThread("addRow");<br>//  System.out.println("addRow---&gt;" + status);<br>  while (status) {<br><br>  }// 完成后才能唤醒其它线程<br>  notify(); // 唤醒最先到达的线程<br> }<br><br> public synchronized void operatingTabelThread(String ttype) {<br>  /**<br>   * 忙标识<br>   */<br>//  System.out.println("operatingTabelThread--status-&gt;" + status);<br>  if (bFull) {<br>   try {<br>//    System.out.println("operatingTabelThread-wait-bFull-&gt;" + bFull);<br>    wait();<br>//    System.out.println("operatingTabelThread-wait-bFull-&gt;" + bFull);<br>   } catch (InterruptedException e) {<br>    // TODO Auto-generated catch block<br>    e.printStackTrace();<br>   } // 后来的线程要等待<br>  }<br>  bFull = true;<br>  type = ttype;<br>  SwingUtilities.invokeLater(runnable);<br>  // asus();<br>//  System.out.println("operatingTabelThread--bFull-&gt;" + bFull);<br>  <br>  while (bFull) {<br>   try {<br>    Thread.sleep(10);<br>   } catch (InterruptedException e) {<br>    // TODO Auto-generated catch block<br>    e.printStackTrace();<br>   }<br><br>  }<br>  status = false;<br>  notify(); // 唤醒最先到达的线程<br>//  System.out.println("operatingTabelThread--status-&gt;" + status);<br><br> }<br><br> /**<br>  * 线程调用的addrow方法<br>  */<br> private void threadAddRow() {<br>//  System.out.println("Runnable--threadAddRow-&gt;" + "start");<br>  int rowcount = this.getRowCount();<br>  if (columnCount &lt; addRowData.length) {<br>   tableModel.setColumnCount(addRowData.length);<br>//   System.out.println(this.getColumnCount() + "------&gt;"<br>//     + addRowData.length);<br>   columnCount = addRowData.length;<br>//   tableModel.fireTableDataChanged();<br>//   tableModel.fireTableStructureChanged();<br>  }<br>  while (this.getColumnCount() &lt; addRowData.length) {<br>//   System.out.println(this.getColumnCount() + "------&gt;"<br>//     + addRowData.length);<br>  }<br>  tableModel.addRow(addRowData);<br>//  tableModel.fireTableDataChanged();<br>//  tableModel.fireTableStructureChanged();<br><br>  while (this.getRowCount() &lt;= rowcount) {<br>//   System.out.println(this.getRowCount() + "------&gt;" + rowcount);<br>  }<br><br>//  System.out.println("Runnable--threadAddRow-&gt;" + "end");<br> }<br><br> public DefaultTableModel getDefaultTableModel() {<br>  return this.tableModel;<br> }<br><br> /**<br>  * @param args<br>  */<br> public static void main(String[] args) {<br>  // TODO Auto-generated method stub<br>  JFrame frame = new JFrame("JTableOperating");<br>  Container c = frame.getContentPane();<br>  JTableOperating table = null;<br>  // table = new JTableOperating(50, 18);<br><br>  Object rows[][] = {};<br>  String columns[] = { "姓名", "国籍", "年龄" };<br>  table = new JTableOperating(new DefaultTableModel(columns, 55));<br>  JScrollPane scrollPane = new JScrollPane(table); // 支持滚动<br>  table.init();<br>  // table.se<br><br>  // jp.add(scrollPane);<br>  c.add(scrollPane);<br>  frame.setSize(700, 500);<br>  frame.setLocation(200, 150);<br>  frame.setTitle("表格");<br>  frame.setVisible(true);<br>  frame.setDefaultCloseOperation(frame.EXIT_ON_CLOSE);<br><br>//  ExcelAdapter myAd = new ExcelAdapter(table);<br><br><br>  for (int i = 0; i &lt; 99009; i++) {<br>   final JTableOperating table1 = table;<br>   if (table1.getRowCount() &gt; 8) {<br>    table1.removeRowsAll();<br>   } else {<br>    table1.addRow(new Object[]{"A","B","C"});<br>   }<br>   try {<br>    Thread.sleep(100);<br>   } catch (InterruptedException e) {<br>    // TODO Auto-generated catch block<br>    e.printStackTrace();<br>   }<br>  }<br> }<br><br><br>}<br></p><div><br></div></pre><br><wbr></div>
	</div>
</div>
</body>
</html>