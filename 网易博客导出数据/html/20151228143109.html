<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>蒋カイセキ 的博客</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">蒋カイセキ 的博客</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">was不生成 heapdump</h2>
	<h5 id="">2015-12-28 14:31:09&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/shoukaiseki/blog/static/192856149201511282319886/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>产生heapdump的根本原因是你的Java堆栈溢出，解决方法：</div><div>1.加大堆空间</div><div>2.检查应用中的内存泄漏</div><div>3.请看下面的解释：</div><div><br></div><div>为什么WebSphere Application Server的IBM JDK在升级到V1.3.1 SR5以后总是自动产生heapdumps和javacores，如何避免</div><div><br></div><div>产品：WebSphere Application Server(以下简称WAS)</div><div>版本：4.0.x,5.0.x,5.1.x</div><div>平台：AIX,Windows,Linux</div><div><br></div><div>问题描述：</div><div>为什么WebSphere Application Server的JDK在升级到V1.3.1 SR5以后总是自动产生heapdumps和javacores</div><div><br></div><div>解答：</div><div>为了辅助第一时间捕捉错续信息，从IBM JDK V1.3.1 SR5(131-20030618)版本开始，当Java的堆空间耗尽时系统会自动的产生heapdumps和javacores。如果希望在Java对空间耗尽时不会自动的产生heapdumps和javacores,请按照如下的步骤操作：</div><div><br></div><div>对于WAS 4.0.x:</div><div>1. 找到&lt;WAS_HOME&gt;/bin/startupServer.sh (.bat)文件,其中&lt;WAS_HOME&gt;表示WAS的安装目录</div><div>2. 用文本编辑器打开该文件，并在文件的顶部添加如下的2行：</div><div>export IBM_HEAPDUMP_OUTOFMEMORY=false</div><div>export IBM_JAVADUMP_OUTOFMEMORY=false</div><div>3. 保存并关闭文件，重新启动WAS</div><div><br></div><div>对于WAS 5.0.x或者5.1.x:</div><div>1. 打开管理控制台，依次选择：服务器 &gt; 应用服务器 &gt; 需要更改的服务器名称 &gt; 进程定义 &gt; 环境条目</div><div>2. 新建如下的2个条目：</div><div>Name <span style="white-space:pre;"   >	</span>Value&nbsp;</div><div>IBM_HEAPDUMP_OUTOFMEMORY <span style="white-space:pre;"   >	</span>false&nbsp;</div><div>IBM_JAVADUMP_OUTOFMEMORY <span style="white-space:pre;"   >	</span>false&nbsp;</div><div>3. 保存配置的更改，重新启动WAS</div><wbr><br><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div>jvm 生成javacore和heapdump文件</div><div><div>（1）如果使用Oracle JVM也就是标准的SUN JVM（SUN已被oracle收购）</div><div>当内存溢出时生成heapdump文件配置如下</div><div>-Xloggc:${目录}/temp_gc.log &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; （GC日志文件）</div><div>-XX:+HeapDumpOnOutOfMemoryError &nbsp; &nbsp; &nbsp; （内存溢出时生成heapdump文件）</div><div>-XX:HeapDumpPath=${目录} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;（heapdump文件存放位置）</div><div><br></div><div>如果要即时动态生成heapdump文件可以使用jmap命令，jdk6.0已取消了-XX:+HeapDumpOnCtrlBreak配置参数通过ctrl+break的方式。</div><div>jmap -dump:format=b,file=temp_heapdump.hprof &lt;pid&gt;</div><div><br></div><div>（2）HP JVM</div><div>-Xverbosegc:file=${目录}/temp_gc.log &nbsp;（GC日志文件）</div><div>-XX:+HeapDumpOnOutOfMemoryError &nbsp; &nbsp; &nbsp; （内存溢出时生成heapdump文件）</div><div>-XX:+HeapDumpOnCtrlBreak &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;（可以通过ctrl+break组合键动态生成heapdump文件）</div><div>-XX:HeapDumpPath=${目录} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;（heapdump文件存放位置）</div><div><br></div><div>（3）IBM JVM</div><div>非windows操作系统环境中</div><div>-XverboseGClog: ${目录}/temp_gc.log &nbsp; （GC日志文件）</div><div>-Xdump:heap:events=user,file=${目录}/pid%uid%pid.phd</div><div>表示可以根据需要通过kill -3 &lt;pid&gt;产生DUMP文件，%uid和%pid为变量</div><div><br></div><div>windows操作系统环境中</div><div>启动wsadmin,进入wsadmin环境</div><div>wsadmin&gt; set jvm [$AdminControl completeObjectName type=JVM,process=server1,*]</div><div>wsadmin&gt; $AdminControl invoke $jvm generateHeapDump</div><div>wsadmin&gt; $AdminControl invoke $jvm dumpThreads</div></div></div>
	</div>
</div>
</body>
</html>